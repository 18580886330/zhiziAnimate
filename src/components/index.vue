<template>
  <div class="index">
    <div class="container">
      <!-- Swiper -->
      <div class="swiper-container">
        <div id="swiperWrapper" class="swiper-wrapper">
          <div class="swiper-slide radial-skyblue">
            <div class="layer start">
              <img class="layer txt_1" src="../assets/images/sswc.png">
              <img class="layer txt_2" src="../assets/images/xzys.png">
            </div>
          </div>
          <div class="swiper-slide radial-skyblue">
            <div class="slide_01">
              <div id="slide_01" class="text-box text-center"></div>
              <div class="scattered-box">
                <div class="layer bengk"><img src="../assets/images/bengk.png"></div>
                <div class="layer aaa"><img src="../assets/images/a.png"></div>
                <div class="icon layer l"></div>
                <div class="icon layer r"></div>
                <img class="layer person_01" src="../assets/images/hua.png">
                <div class="layer user-info">
                  <p>汪幸 28岁</p>
                  <p>某房地产经纪</p>
                  <p>公司销售</p>
                </div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-skyblue">
            <div class="joinus">
              <div class="logo"><img src="../assets/images/logo.png"></div>
              <div class="reality">
                <div class="text-box">
                  <div class="text">
                    <div class="big">权威</div><div class="small">数据来源</div>
                  </div>
                  <div class="text">
                    <div class="small">全量</div><div class="big">真实</div><div class="small">成交</div>
                  </div>
                  <div class="text">
                    <div class="big">全量</div><div class="small">楼盘覆盖</div>
                  </div>
                </div>
              </div>
              <div class="code-box">
                <h3 class="h3">一站式二手房数据研究服务平台</h3>
                <div class="code">
                  <img src="../assets/images/code.png">
                </div>
                <div class="s-text">天使用户招募中</div>
                <div class="s-text">详情咨询：010-60845501</div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-violet">
            <div class="slide_02">
              <div id="slide_02" class="text-box text-center"></div>
              <div class="scattered-box">
                <div class="layer bengk"><img src="../assets/images/yumen.png"></div>
                <div class="icon layer l"></div>
                <div class="icon layer r"></div>
                <img class="layer person_01" src="../assets/images/nv.png">
                <div class="layer user-info">
                  <p>闰笑梅 24岁</p>
                  <p>某房地产开发公司</p>
                  <p>策划专员</p>
                </div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-violet">
            <div class="joinus">
              <div class="logo"><img src="../assets/images/logo.png"></div>
              <div class="reality">
                <div class="text-box">
                  <div class="text">
                    <div class="big">小区</div><div class="small">细分统计</div>
                  </div>
                  <div class="text">
                    <div class="big">多重</div><div class="small">特色标签</div>
                  </div>
                  <div class="text">
                    <div class="small">中介机构</div><div class="big">监测</div>
                  </div>
                </div>
              </div>
              <div class="code-box">
                <h3 class="h3">一站式二手房数据研究服务平台</h3>
                <div class="code">
                  <img src="../assets/images/code.png">
                </div>
                <div class="s-text">天使用户招募中</div>
                <div class="s-text">详情咨询：010-60845501</div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-blue">
            <div class="slide_03">
              <div id="slide_03" class="text-box text-center"></div>
              <div class="scattered-box">
                <div class="layer bengk"><img src="../assets/images/jiujie.png"></div>
                <div class="icon layer l"></div>
                <div class="icon layer r"></div>
                <img class="layer person_01" src="../assets/images/wang.png">
                <div class="layer user-info">
                  <p>聂奇峰 26岁</p>
                  <p>某房产</p>
                  <p>网站记者</p>
                </div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-blue">
            <div class="joinus">
              <div class="logo"><img src="../assets/images/logo.png"></div>
              <div class="reality">
                <div class="text-box">
                  <div class="text">
                    <div class="small">多维</div><div class="big">交叉</div><div class="small">分析</div>
                  </div>
                  <div class="text">
                    <div class="small">定制</div><div class="big">特色</div><div class="small">榜单</div>
                  </div>
                  <div class="text">
                    <div class="small">多类数据</div><div class="big">可视化</div>
                  </div>
                </div>
              </div>
              <div class="code-box">
                <h3 class="h3">一站式二手房数据研究服务平台</h3>
                <div class="code">
                  <img src="../assets/images/code.png">
                </div>
                <div class="s-text">天使用户招募中</div>
                <div class="s-text">详情咨询：010-60845501</div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-coffee">
            <div class="slide_04">
              <div id="slide_04" class="text-box text-center"></div>
              <div class="scattered-box">
                <div class="layer bengk"><img src="../assets/images/what.png"></div>
                <div class="icon layer l"></div>
                <img class="layer person_01" src="../assets/images/lan.png">
                <div class="layer user-info">
                  <p>蓝天 24岁 某金融服务公司风控经理</p>
                </div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-coffee">
            <div class="joinus">
              <div class="logo"><img src="../assets/images/logo.png"></div>
              <div class="reality">
                <div class="text-box">
                  <div class="text">
                    <div class="big">在线</div><div class="small">数据咨询</div>
                  </div>
                  <div class="text">
                    <div class="big">定制</div><div class="small">咨询报告</div>
                  </div>
                  <div class="text">
                    <div class="small">支持</div><div class="big">API</div><div class="small">调用</div>
                  </div>
                </div>
              </div>
              <div class="code-box">
                <h3 class="h3">一站式二手房数据研究服务平台</h3>
                <div class="code">
                  <img src="../assets/images/code.png">
                </div>
                <div class="s-text">天使用户招募中</div>
                <div class="s-text">详情咨询：010-60845501</div>
              </div>
            </div>
          </div>
          <div class="swiper-slide radial-coffee">
            <div class="swiper-slide">
              <div class="probation-panel">
                <h3>申请试用</h3>
                <ul class="probation-list">
                  <li><input v-model="unameVal" type="text" class="input" placeholder="请输入您的用户名"></li>
                  <li><input v-model="phoneVal" type="text" class="input" placeholder="请输入您的手机号" maxlength="11"></li>
                  <li><input v-model="imgCodeVal" type="text" class="input pic-yzm" placeholder="输入验证码"><img class="img-yzm" :src="imgCode"><span @click="changeCode()" class="change-yzm">看不清<br>请点击</span></li>
                  <li><input v-model="phoneCodeVal" type="text" class="input phone-yzm" placeholder="请输入手机验证码"><a @click="getPhoneCode()" id="getPhoneCode" href="javascript:;" class="layer get-code">获取验证码</a></li>
                  <li><input v-model="companyNameVal" type="text" class="input" placeholder="请输入公司／机构名称"></li>
                  <li>
                    <select v-model="industryVal" class="select" name="" id="">
                      <option v-for="(val,key) in industryArr" :value="val">{{val}}</option>
                    </select>
                  </li>
                  <li><a @click="submit()" href="javascript:;" class="btn submit">提交申请</a></li>
                </ul>
                <p class="tel">详情咨询：010-60845501</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
      </div>
      <div id="topArrow" class="layer top-arrow"></div>
      <div id="audioIcon" class="audio-icon play"></div>
      <audio id="audio" preload loop="loop" autoplay="autoplay" src="static/media/m.mp3"></audio>
    </div>

    <!--加载进度显示-->
    <div class="load">
        <div class="con-load">
            <img src="../assets/images/loading.png">
            <p id="loadingNum"></p>
        </div>
    </div>
    <!--旋转提示-->    <!-- 选择禁止横屏或竖屏显示-->
    <div id="orientLayer" class="mod-orient-layer">
        <div class="mod-orient-layer__content">
            <i class="mod-orient-layer__icon-orient"></i>
            <div class="mod-orient-layer__desc">为了更好的体验，请使用竖屏浏览</div>
        </div>
    </div>

  </div>
</template>

<script>
import axios from "axios";
import qs from "qs";

export default {
  name: "HelloWorld",
  data() {
    return {
      unameVal: '',
      phoneVal: '',
      phoneCodeVal: '',
      imgCodeVal: '',
      companyNameVal:  '',
      industryVal: '请选择行业',
      industryArr: ['请选择行业','金融','开发商','中介','咨询','数据','媒体','其他'],
      imgCode: "/getGifCode.do?" + Math.random() * 1000,
      defaultLayId: 0
    }
  },
  mounted() {
    // this.getPicYzm();
    this.musicRun();
  },
  methods: {
    musicRun() {
      var audioBtn = document.getElementById('audioIcon');
      var audio = document.getElementById('audio');
      if(dom.isIos()){
        audio.play();
        document.addEventListener("WeixinJSBridgeReady", function () {
          audio.play();
        }, false);
      }

      if(audio.paused) {
        audio.play();
        audioBtn.className = 'audio-icon play';
      }

      audioBtn.onclick = function() {
        if(audio.paused) {
          audio.play();
          audioBtn.className = 'audio-icon play';
        }else{
          audio.pause();
          audioBtn.className = 'audio-icon';
        }
      }
    },
    layerOpen(msg) {
      let oBody = document.getElementsByTagName('body')[0];

      if( document.getElementById('layer-content') ) {
        oBody.removeChild(document.getElementById('layer-content'));
      }
      this.defaultLayId++;

      let layerDiv = document.createElement('div');
          layerDiv.setAttribute('class','layer layer-content');
          layerDiv.setAttribute('id','layer-content');
          layerDiv.style.display =  'none';

      oBody.appendChild(layerDiv);
      layerDiv.setAttribute('layId',this.defaultLayId);

      let layContent = document.createElement('div');
          layContent.setAttribute('class','content');
          layContent.innerHTML = msg;

      layerDiv.appendChild(layContent);

      layerDiv.style.display = 'block';
      layContent.style.cssText = 'margin-left:-'+(layContent.offsetWidth/2)+'px;margin-top:-'+(layContent.offsetHeight/2)+'px;';
      
      setTimeout(()=>{
          if(layerDiv&&layerDiv.getAttribute('layId') == this.defaultLayId) {
            oBody.removeChild( layerDiv );
          }
      },3000);
      
    },
    // 切换验证码
    changeCode() {
      this.imgCode = "/getGifCode.do?" + Math.random() * 1000;
    },
    // 手机验证码
    getPhoneCode() {
      if( dom.hasClass(document.getElementById('getPhoneCode'),'disable') ) return;
      
      // 验证规则
      if( this.unameVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入您的姓名~');
      }else if( this.phoneVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入您的手机号~');
      }else if( this.phoneVal.replace(/\s/g,'') != '' && !/^1[3,4,5,7,8]\d{9}$/.test(this.phoneVal.replace(/\s/g,'')) ) {
        return this.layerOpen('您的手机号码格式不正确~');
      }else if( this.imgCodeVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入图片验证码~');
      }
      axios
        .post(
          "/applyTrialMsg.do",
          qs.stringify({
            phone: this.phoneVal,
            vcode: this.imgCodeVal
          })
        )
        .then(function(response) {
          console.log(response.data);
          let data = response.data;
          if( !data.success ) {
            this.changeCode();
            return this.layerOpen(data.message);
          }
          // 短信验证码发送成功，改变按钮状态
          new TimerEnd().init('getPhoneCode',60);
          return this.layerOpen(data.message);
        }.bind(this))
        .catch(function(error) {
          console.log(error);
        });
    },
    // 提交申请
    submit() {
      // 验证规则
      if( this.unameVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入您的姓名~');
      }else if( this.phoneVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入您的手机号~');
      }else if( this.phoneVal.replace(/\s/g,'') != '' && !/^1[3,4,5,7,8]\d{9}$/.test(this.phoneVal.replace(/\s/g,'')) ) {
        return this.layerOpen('您的手机号码格式不正确~');
      }else if( this.imgCodeVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('请输入图片验证码~');
      }else if( this.phoneCodeVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('手机验证码不能为空~');
      }else if( this.companyNameVal.replace(/\s/g,'') == '' ) {
        return this.layerOpen('机构名称不能为空~');
      }else if( this.industryVal == '请选择行业' ) {
        return this.layerOpen('请选择行为~');
      }

      // 2.提交ajax
      axios.post('/applyTrial.do',qs.stringify({
        phone: this.phoneVal,
        mcode: this.phoneCodeVal,
        name: this.unameVal.replace(/<.[^<>]*?>|\s/g,""),
        company: this.companyNameVal.replace(/<.[^<>]*?>|\s/g,""),
        industry: this.industryVal
      }))
      .then(function(response) {
        let data = response.data;
        if( data.success ) {
          this.unameVal = '';
          this.phoneVal = '';
          this.phoneCodeVal = '';
          this.imgCodeVal = '';
          this.companyNameVal =  '';
          this.industryVal = '请选择行业';
          return this.layerOpen(data.message);
        }
      }.bind(this))
      .catch(function(error) {
        console.log(error);
      })
      
    }

    ///

    /* getPicYzm() {
      axios.get('/getGifCode.do')
      .then(function(res) {
        console.log(res)
        console.log(this)
        this.imgCode = res.data;
      }.bind(this))
      .catch(function(error){
        console.log(error)
      })
    } */
  }
};
</script>

<style>
.index {
  height: 100%;
}
</style>
